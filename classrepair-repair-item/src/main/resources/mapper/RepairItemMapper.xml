<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="team.weacsoft.repair.mapper.RepairItemMapper">
    <select id="getRepairItemByState" resultType="team.weacsoft.repair.dto.common.CommonRepairItemDto">
        SELECT
            ri.create_time,
            ri.update_time,
            ri.classroom,
            ri.problem,
            ri.repair_item_id,
            ri.orderer,
            u2.`name` AS orderer_name,
            ri.receiver,
            u1.`name` AS receiver_name,
            qa.title
        FROM
            repair_item ri
            LEFT JOIN user_info u1 ON ri.receiver = u1.id
            LEFT JOIN user_info u2 ON ri.orderer = u2.id
            LEFT JOIN qa_type qa ON ri.equipment_type = qa.id
        WHERE
            1 =1
        <if test="receiver != null">
            and ri.receiver = #{receiver}
        </if>
        <if test="state != null">
            and ri.state = #{state}
        </if>
        <if test="neReceiver != null">
            and ri.receiver != #{neReceiver}
        </if>
    </select>

</mapper>
